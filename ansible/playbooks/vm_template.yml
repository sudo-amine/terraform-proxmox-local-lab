---
- name: Start VM and Configure SSH
  hosts: localhost
  gather_facts: false
  roles:
    - proxmox_api_authentication
    - start_vm

- name: Install and Configure VM
  hosts: vm_template
  gather_facts: true
  become: true
  roles:
    - update_package
    - install_dependencies
    - configure_qemu
    - add_control_plane_endpoint

- name: Stop VM
  hosts: localhost
  gather_facts: false
  roles:
    - stop_vm
